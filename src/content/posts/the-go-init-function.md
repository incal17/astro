---
title: "Go è¯­è¨€ä¸­çš„ init å‡½æ•°ï¼ˆè¯‘ï¼‰"
description: "æœ‰æ—¶å€™ï¼Œåœ¨åˆ›å»º golang åº”ç”¨ç¨‹åºçš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åœ¨ç¨‹åºåˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡ŒæŸäº›æ“ä½œã€‚å¦‚åˆå§‹åŒ–æ•°æ®åº“çš„è¿æ¥ã€è½½å…¥æœ¬åœ°é…ç½®æ–‡ä»¶ç­‰ã€‚"
pubDate: "2020-10-30 09:42:11"
category: "golang"
banner: "@images/banners/gsjg5h5pRyfRBreK7ED4eO8lls2AlWq9V2oEdBKx.png"
tags: ["golang"]
oldViewCount: 2955
oldKeywords: ["goåˆå§‹åŒ–,initå‡½æ•°,åˆå§‹åŒ–,go,init"]
---

> æœ¬æ–‡è¯‘è‡ª [The Go init Function](https://tutorialedge.net/golang/the-go-init-function/)
> 

æœ‰æ—¶å€™ï¼Œåœ¨åˆ›å»º golang åº”ç”¨ç¨‹åºçš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åœ¨ç¨‹åºåˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡ŒæŸäº›æ“ä½œã€‚å¦‚åˆå§‹åŒ–æ•°æ®åº“çš„è¿æ¥ã€è½½å…¥æœ¬åœ°é…ç½®æ–‡ä»¶ç­‰ã€‚

è€Œåœ¨ Go è¯­è¨€ä¸­ï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯é€šè¿‡  `init()` å‡½æ•°æ¥å®Œæˆçš„ã€‚åœ¨æœ¬ç¯‡æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•æ›´ä¼˜é›…ï¼ˆfame and gloryï¼‰çš„ä½¿ç”¨ `init()` å‡½æ•°ï¼Œæˆ–è®¸èƒ½å¸®åŠ©ä½ æ„å»ºä½ çš„ä¸‹ä¸€ä¸ª go é¡¹ç›®ã€‚

## Go ä¸­çš„åˆå§‹åŒ–å‡½æ•°

åœ¨ Go è¯­è¨€ä¸­ï¼Œ`init()` å‡½æ•°çš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå¹¶ä¸”æ¯”å…¶ä»–è¯­è¨€æ›´å®¹æ˜“ä½¿ç”¨ã€‚`init()` å‡½æ•°å¯ä»¥åœ¨ package çš„ block ä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”æ— è®ºè¯¥åŒ…è¢«å¯¼å…¥å¤šå°‘æ¬¡ï¼Œ`init()` å‡½æ•°å°†å§‹ç»ˆä»…è¢«è°ƒç”¨ä¸€æ¬¡ã€‚

ç°åœ¨ï¼Œè¯·çœ‹ä¸‹é¢çš„åˆ—å­ï¼Œ`init`  å‡½æ•°å®šä¹‰çš„å†…å®¹åªè¢«æ‰§è¡Œäº†ä¸€æ¬¡ã€‚è¿™ç§ç‰¹æ€§èƒ½ä½¿ç”¨æˆ‘ä»¬æœ‰æ•ˆçš„å»ºç«‹æ•°æ®åº“è¿æ¥ã€æ³¨å†Œå„ç§å„æ ·çš„æœåŠ¡ï¼Œæˆ–æ‰§è¡Œæ‚¨åªæƒ³æ‰§è¡Œä¸€æ¬¡çš„å…¶ä»–ä»»åŠ¡ã€‚

```go
package main

func init() {
  fmt.Println("This will get called on main initialization")
}

func main() {
  fmt.Println("My Wonderful Go Program")
}
```

è¯·æ³¨æ„ï¼Œåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æ˜¾ç¤ºçš„è°ƒç”¨ `init()` å‡½æ•°ï¼ŒGo è¯­è¨€ä¼šéšå¼åœ°ä¸ºæˆ‘ä»¬å¤„ç†æ‰§è¡Œï¼Œå› æ­¤ä¸Šè¿°ç¨‹åºåº”æä¾›å¦‚ä¸‹æ‰€ç¤ºçš„è¾“å‡ºï¼š

```bash
$ go run test.go
This will get called on main initialization
My Wonderful Go Program
```

åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€äº›å¾ˆæ£’çš„äº‹æƒ…ï¼Œä¾‹å¦‚å˜é‡åˆå§‹åŒ–ã€‚

```go
package main

import "fmt"

var name string

func init() {
    fmt.Println("This will get called on main initialization")
    name = "Elliot"
}

func main() {
    fmt.Println("My Wonderful Go Program")
    fmt.Printf("Name: %s\n", name)
}
```

åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œä¸å¿…é¡»æ˜¾ç¤ºçš„è°ƒç”¨å®šä¹‰çš„å‡½æ•°ç›¸æ¯”ï¼Œ`init()` å‡½æ•°ä¼šæ›´å—æ¬¢è¿ã€‚å½“è¿è¡Œä¸Šè¿°ç¨‹åºæ—¶ï¼Œå˜é‡å name çš„å€¼å·²ç»è¢«åˆå§‹åŒ–ã€‚

```bash
$ go run test.go
This will get called on main initialization
My Wonderful Go Program
Name: Elliot
```

## Multiple Packages
è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€ä¸ªæ›´å¤æ‚çš„åœºæ™¯ï¼Œå®ƒæ›´æ¥è¿‘äºç”Ÿäº§ç¯å¢ƒã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­æœ‰ 3 ä¸ªä¸åŒçš„ Go åŒ…ï¼Œåˆ†åˆ«æ˜¯ mainã€brokerã€databaseã€‚

åœ¨æ¯ä¸€ä¸ªåŒ…ä¸­ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æŒ‡å®šä¸€ä¸ª init() å‡½æ•°ï¼Œæ¯”å¦‚ç”¨äºè®¾ç½® Kafka æˆ– MySQL çš„è¿æ¥æ± ã€‚å½“æˆ‘ä»¬è°ƒç”¨ database åŒ…ä¸­çš„å‡½æ•°æ—¶ï¼Œå®ƒå°†è‡ªåŠ¨è°ƒç”¨ init å‡½æ•°å¹¶åˆå§‹åŒ–è¿æ¥æ± ã€‚

> ğŸœï¼šä½ ä¸èƒ½ä¾èµ–å¤šä¸ª init() å‡½æ•°çš„æ‰§è¡Œé¡ºåºã€‚ä¸å…¶å¦‚æ­¤ï¼Œè¿˜ä¸å¦‚æŠŠç²¾åŠ›èŠ±è´¹åœ¨å…¶ä»–é€»è¾‘çš„ç¼–å†™ä¸Šã€‚  

## Init çš„åˆå§‹åŒ–é¡ºåº

å¯¹äºæ›´å¤æ‚çš„ç³»ç»Ÿï¼Œä½ çš„æ¯ä¸ªåŒ…ä¸­å¯èƒ½åŒ…å«å¤šä¸ªæ–‡ä»¶ã€‚æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½å¯èƒ½æœ‰è‡ªå·±çš„ init å‡½æ•°ã€‚é‚£ä¹ˆ Go æ˜¯å¦‚ä½•åˆå§‹åŒ–è¿™äº›åŒ…çš„é¡ºåºçš„å‘¢ï¼Ÿ

å½“æ¶‰åŠåˆ°åˆå§‹åŒ–é¡ºåºæ—¶ï¼Œéœ€è¦è€ƒè™‘ä¸€äº›äº‹é¡¹ã€‚ Go é€šå¸¸æŒ‰ç…§å£°æ˜çš„é¡ºåºè¿›è¡Œåˆå§‹åŒ–ï¼Œä½†å¦‚æœå£°æ˜çš„å˜é‡ä¾èµ–å¦å¤–åŒ…ä¸­çš„å˜é‡æˆ–æ–¹æ³•ï¼Œé‚£å°†
ä½†æ˜¯ä¼šåœ¨å®ƒä»¬å¯èƒ½ä¾èµ–çš„ä»»ä½•å˜é‡ä¹‹åæ˜¾å¼åˆå§‹åŒ–ã€‚ è¿™æ„å‘³ç€ï¼Œå‡è®¾æ‚¨åœ¨åŒä¸€è½¯ä»¶åŒ…ä¸­æœ‰ä¸¤ä¸ªæ–‡ä»¶ a.go å’Œ b.goï¼Œè‹¥ a.go ä¸­ä»»ä½•å†…å®¹çš„åˆå§‹åŒ–éƒ½å–å†³äº b.go ä¸­çš„å†…å®¹ï¼Œåˆ™ a.go å°†é¦–å…ˆè¢«åˆå§‹åŒ–ã€‚

> ğŸœï¼šå¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°æœ‰å…³Goä¸­åˆå§‹åŒ–é¡ºåºçš„æ›´æ·±å…¥æ¦‚è¿°ï¼š[The Go Programming Language Specification - The Go Programming Language](https://golang.org/ref/spec#Package_initialization)  

æ¥çœ‹ä¸‹é¢çš„åˆ—å­ï¼š

```go
// source: https://stackoverflow.com/questions/24790175/when-is-the-init-function-run
var WhatIsThe = AnswerToLife()

func AnswerToLife() int {
    return 42
}

func init() {
    WhatIsThe = 0
}

func main() {
    if WhatIsThe == 0 {
        fmt.Println("It's all a lie.") // è¾“å‡ºè¿™è¡Œ
    }
}
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨ä¼šçœ‹åˆ° AnswerToLife å‡½æ•°å°†åœ¨ init å‡½æ•°ä¹‹å‰è¿è¡Œï¼Œå› ä¸º WhatIsThe å˜é‡æ˜¯åœ¨è°ƒç”¨æˆ‘ä»¬çš„ init å‡½æ•°ä¹‹å‰å£°æ˜çš„ã€‚

## åŒä¸€æ–‡ä»¶ï¼Œå¤šä¸ª init å‡½æ•°

å¦‚æœæˆ‘ä»¬åœ¨åŒä¸€ä¸ª Go æ–‡ä»¶é‡Œå®šä¹‰å¤šä¸ª init() å‡½æ•°ä¼šæ€æ ·ï¼Ÿä¸€å¼€å§‹æˆ‘è®¤ä¸ºè¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œä½† Go ç¡®å®æ”¯æŒåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­æ‹¥æœ‰ 2 ä¸ªç‹¬ç«‹çš„ init() å‡½æ•°ã€‚

è¿™äº› init() å‡½æ•°æŒ‰å£°æ˜é¡ºåºä¾æ¬¡è°ƒç”¨ã€‚

> ç›®å‰åŒä¸€ä¸ª go æ–‡ä»¶ä¸­æ˜¯æ”¯æŒå¤šä¸ª init å‡½æ•°çš„ï¼Œä¸æ­¢ 2 ä¸ªã€‚  

```go
package main

import "fmt"

var initCounter int

func init() {
    initCounter ++
}
func init() {
    initCounter ++
}
func init() {
    initCounter ++
}
func init() {
    initCounter ++
}

func init() {
    initCounter ++
}

func main() {
    fmt.Println(initCounter) //5
}
```

ä½†æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å°† init æ‹†åˆ†ä¸ºå¤šä¸ªå‘¢ï¼Ÿè¿™æ ·åšæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿå…¶å®å¯¹äºå¤æ‚çš„ç³»ç»Ÿï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥å°†å¤æ‚çš„åˆå§‹åŒ–è¿‡ç¨‹åˆ†è§£ä¸ºå¤šä¸ªæ˜“äºç†è§£çš„ init å‡½æ•°ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼Œå®ƒä½¿æˆ‘ä»¬å¯ä»¥é¿å…åœ¨å•ä¸ª init å‡½æ•°ä¸­åŒ…å«ä¸€å¤§æ¨ä»£ç ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŒä¸€æ–‡ä»¶ä¸­çš„å¤šä¸ª init å‡½æ•°æ˜¯æŒ‰å£°æ˜æ—¶çš„é¡ºåºåˆå§‹åŒ–çš„ï¼Œè¿™ç‚¹åœ¨æ‹†åˆ†æ—¶è¦ç‰¹åˆ«å°å¿ƒã€‚

## ç»“è®º

è‡³æ­¤ï¼Œå…³äº init() å‡½æ•°çš„åŸºæœ¬ä»‹ç»å°±ç»“æŸäº†ã€‚ä¸€æ—¦ä½ æŒæ¡äº†åŒ…åˆå§‹åŒ–çš„ä½¿ç”¨ï¼Œä½ å¯èƒ½ä¼šå‘ç°å®ƒå¯¹æŒæ¡åŸºäº Go é¡¹ç›®çš„ç»“æ„åŒ–è‰ºæœ¯å¾ˆæœ‰ç”¨ã€‚

åŸæ–‡åœ°å€ [[[The Go init Function | TutorialEdge.net](https://tutorialedge.net/golang/the-go-init-function/#conclusion)]]
